---
- name: Setup ubuntu container
  hosts: localhost
  connection: local
  tasks:
  - name: Install basic packages
    ansible.builtin.apt:
      name: [ "sudo", "nano", "vim", "usbutils", "curl", "software-properties-common", "unzip", "git", "net-tools", "iproute2" ]
      state: present

  - name: Set root password
    ansible.builtin.user:
      name: root
      state: present
      password: '$6$tFmshjom4$dAmQ.y1v3fbzhTvcpEVpzq/aqaG9VisgfqN6PC33lIGLZTiYhuj.M5PtQPAHwK5fRC9twBDAe6BjtAulcN/Vq.'

  - name: Ensure "sudo" group exists
    ansible.builtin.group:
      name: sudo
      state: present

  - name: Add user
    ansible.builtin.user:
      name: "{{ username }}"
      state: present
      password: '$6$tFmshjom4$dAmQ.y1v3fbzhTvcpEVpzq/aqaG9VisgfqN6PC33lIGLZTiYhuj.M5PtQPAHwK5fRC9twBDAe6BjtAulcN/Vq.'
      group: users
      groups: [ "users", "sudo", "dialout" ]
      create_home: yes

  - name: Install software dependencies
    ansible.builtin.apt:
      name: [ "direnv", "build-essential", "clang", "curl", "python3.10", "python3.10-venv", "libserialport-dev" ]
      state: present

  - name: Add direnv shell hook
    ansible.builtin.lineinfile:
      path: /home/{{ username }}/.bashrc
      line: 'eval "$(direnv hook bash)"'
