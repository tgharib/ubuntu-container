---
- name: Setup ubuntu container
  hosts: localhost
  connection: local
  tasks:
  - name: Install basic packages
    ansible.builtin.apt:
      name: [ "sudo", "nano", "vim", "usbutils", "curl", "software-properties-common", "unzip", "git", "net-tools", "iproute2" ]
      state: present

  - name: Set root password
    ansible.builtin.user:
      name: root
      state: present
      password: '$6$tFmshjom4$dAmQ.y1v3fbzhTvcpEVpzq/aqaG9VisgfqN6PC33lIGLZTiYhuj.M5PtQPAHwK5fRC9twBDAe6BjtAulcN/Vq.'

  - name: Ensure "sudo" group exists
    ansible.builtin.group:
      name: sudo
      state: present

  - name: Add user
    ansible.builtin.user:
      name: "{{ username }}"
      state: present
      password: '$6$tFmshjom4$dAmQ.y1v3fbzhTvcpEVpzq/aqaG9VisgfqN6PC33lIGLZTiYhuj.M5PtQPAHwK5fRC9twBDAe6BjtAulcN/Vq.'
      group: users
      groups: [ "users", "sudo", "dialout" ]
      create_home: yes

  - name: Add arch file
    ansible.builtin.file:
      path: /var/lib/dpkg/arch
      owner: root
      group: root
      mode: '0644'
      state: touch
  - name: Add amd64 arch
    ansible.builtin.lineinfile:
      path: /var/lib/dpkg/arch
      line: 'amd64'
  - name: Add i386 arch
    ansible.builtin.lineinfile:
      path: /var/lib/dpkg/arch
      line: 'i386'
  - name: Install steam 32-bit dependencies
    ansible.builtin.apt:
      update_cache: true
      name: [ "libc6:amd64", "libc6:i386", "libegl1:amd64", "libegl1:i386", "libgbm1:amd64", "libgbm1:i386", "libgl1-mesa-dri:amd64", "libgl1-mesa-dri:i386", "libgl1:amd64", "libgl1:i386" ]
      state: present
